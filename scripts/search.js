const initSearch=(e,t)=>{const s=(new Date).getTime();const{searchParams:n}=new URL(location.href);const i=n.get("s");const r=["<p>这是宝硕博客的站内搜索引擎。</p>",'<p>搜索多个关键词时请用空格分隔,如「<a href="/search/?s=网页+深色模式">网页 深色模式</a>」、「<a href="/search/?s=CTF+Write+Up">CTF Write Up</a>」、「<a href="/search/?s=题解">题解</a>」</p>'].join("");const a=[`<p>找不到和「${i}」相符的文章。`,`<small>（耗时 <span id="search-used-time">null</span> 毫秒）</small>`,`</p>`,`<p>请检查关键字是否有误，或尝试搜索其它关键字。你也可以前往 `,`<a href="https://www.google.com/search?q=site%3Ablog.baoshuo.ren%20${encodeURIComponent(i)}">Google</a>`,` 或 <a href="https://www.bing.com/search?q=site%3Ablog.baoshuo.ren%20${encodeURIComponent(i)}">Bing</a>`,` 搜索「<a href="https://www.google.com/search?q=site%3Ablog.baoshuo.ren%20${encodeURIComponent(i)}">${i}</a>」。`,`</p>`].join("");const l=['<p style="text-align: center;">','获取文章数据出错，请尝试 <a href="javascript:location.reload();"><b>重新加载</b></a> 。',"</p>"].join("");if(i===null||i.trim()===""){t.innerHTML=r}else{e.value=i;fetch("/search.json").then((e=>e.json())).then((e=>{let n=new Fuse(e,{includeMatches:true,findAllMatches:true,threshold:.45,keys:["title","content","tags","categories"]}).search(i);let r=['<div id="search-result-info" class="search-result-info"></div>'];console.log("Search result:",n);n.forEach((e=>{r.push(['<div class="divider"></div>','<a href="'+e.item.url.substring(1,e.item.url.length)+'" class="search-result-link">','<div class="search-result-item">','<div class="search-result-item-title">'].join(""));let t=false;let s=false;let n=[];let i=[];e.matches.forEach((r=>{if(r.key==="title"){t=true;let s=0;r.indices.forEach((t=>{n.push([e.item.title.substring(s,t[0]),"<mark>",e.item.title.substring(t[0],t[1]+1),"</mark>"].join(""));s=t[1]+1}));n.push(e.item.title.substring(s))}else if(r.key=="content"){s=true;let t=r.indices[0][0]-30;let n=r.indices[0][1]+130;let a=t;r.indices.forEach((s=>{if(s[0]>=t&&s[1]<=n){i.push([e.item.content.substring(a,s[0]),"<mark>",e.item.content.substring(s[0],s[1]+1),"</mark>"].join(""));a=s[1]+1}}));i.push(e.item.content.substring(a,n+1))}}));if(t){r.push(n.join(""))}else{r.push(e.item.title)}r.push(["</div>",'<div class="search-result-item-description">'].join(""));if(s){r.push(i.join(""))}else{r.push(e.item.content.substring(0,130))}r.push(["</div>","</div>","</a>"].join(""))}));const l=(new Date).getTime();if(!n.length){t.innerHTML=a;document.getElementById("search-used-time").innerHTML=l-s}else{t.innerHTML=r.join("");document.getElementById("search-result-info").innerHTML=`<b>搜索结果</b><small>（耗时 ${l-s} 毫秒）</small>`}})).catch((e=>{console.error(e);t.innerHTML=l}))}};initSearch(document.getElementById("search-input"),document.getElementById("search-result"));