<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.baoshuo.ren</id>
    <title>宝硕博客 • Posts by &#34;网络&#34; tag</title>
    <link href="https://blog.baoshuo.ren" />
    <updated>2020-08-20T05:22:47.000Z</updated>
    <category term="BIRD" />
    <category term="BGP" />
    <category term="DN42" />
    <category term="网络" />
    <category term="Web" />
    <category term="CTF" />
    <category term="Git" />
    <category term="折腾" />
    <category term="Linux" />
    <category term="笔记" />
    <category term="题解" />
    <category term="洛谷" />
    <category term="游记" />
    <category term="牛客网" />
    <category term="S2OJ" />
    <category term="CloudFlare" />
    <category term="macOS" />
    <category term="前端" />
    <entry>
        <id>https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/</id>
        <title>给腾讯云服务器免费增加第二个 IP</title>
        <link rel="alternate" href="https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/"/>
        <content type="html"><![CDATA[ <h2 id="前言">前言</h2>
<p>良心云果然是良心云，增加了一个IP四舍五入居然不要钱，不过还是要登进系统配置一下双IP的。</p>
<a id="more"></a>
<p><img src="https://vip2.loli.io/2020/11/26/rAyvBmDw2bdMP6t.jpg" alt="" loading="lazy" data-action="zoom"></p>
<p>和客服的对话</p>
<h2 id="增加网卡-公网IP">增加网卡&amp;公网IP</h2>
<p><img src="https://vip2.loli.io/2020/11/26/SWwlbLRaHACnuBz.png" alt="" loading="lazy" data-action="zoom"></p>
<p>点击按钮新建一个弹性网卡并绑定</p>
<p><img src="https://vip1.loli.io/2020/11/26/sJqBfdbv4eRzZFm.png" alt="" loading="lazy" data-action="zoom"></p>
<p>绑定完以后可以在服务器的弹性网卡管理页面看到详情</p>
<p><img src="https://vip1.loli.io/2020/11/26/ivPFgfH69XTCo8Z.png" alt="" loading="lazy" data-action="zoom"></p>
<p>点击新建的弹性网卡，进入管理页面，并记录下这张网卡的<strong>内网IP</strong>，稍后会用到</p>
<p><img src="https://vip1.loli.io/2020/11/26/FAy8U5lpzNtuMTi.png" alt="" loading="lazy" data-action="zoom"></p>
<p>点击绑定按钮，并申请一个弹性公网IP</p>
<p><img src="https://vip2.loli.io/2020/11/26/AbZ4vTwr1UCdz2n.png" alt="" loading="lazy" data-action="zoom">
<img src="https://vip2.loli.io/2020/11/26/2G5jsdTSZrocqwh.png" alt="" loading="lazy" data-action="zoom"></p>
<p>此时弹性公网IP已经绑定成功，并且可以看到已经变为不收取IP资源费的状态了</p>
<p><img src="https://vip1.loli.io/2020/11/26/x8q7I5E2dMSDt4B.png" alt="" loading="lazy" data-action="zoom"></p>
<p>查看主网卡的<strong>内网IP</strong>，并记录下这个IP，稍后会用到</p>
<h2 id="配置服务器的网络设置">配置服务器的网络设置</h2>
<p>使用 <code>ip addr</code> 查看网卡名称，并记录下来</p>
<p><img src="https://vip2.loli.io/2020/11/26/Ofh8CzvnYKPGsH7.png" alt="" loading="lazy" data-action="zoom"></p>
<p>切换到网卡配置文件目录</p>
<pre><code class="highlight bash"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/</code></pre>
<p>编辑 <code>ifcfg-eth0</code> 文件，将下方内容修改后填入</p>
<pre><code class="highlight ini"><span class="attr">DEVICE</span>=<span class="string">&quot;eth0&quot;</span>             <span class="comment"># 弹性网卡名称</span>
<span class="attr">NM_CONTROLLED</span>=<span class="string">&quot;yes&quot;</span>       <span class="comment"># 是否由 Network Manager 控制该网络接口</span>
<span class="attr">ONBOOT</span>=<span class="string">&quot;yes&quot;</span>              <span class="comment"># 系统启动时是否激活</span>
<span class="attr">IPADDR</span>=<span class="string">&quot;172.21.0.10&quot;</span>      <span class="comment"># 弹性网卡上的 IP 地址</span>
<span class="attr">NETMASK</span>=<span class="string">&quot;255.255.240.0&quot;</span>   <span class="comment"># 子网掩码</span>
<span class="attr">GATEWAY</span>=<span class="string">&quot;172.21.0.1&quot;</span>      <span class="comment"># 网关</span></code></pre>
<ul>
<li>其中 <code>IPADDR</code> 填写主网卡的<strong>内网IP</strong>。</li>
<li>子网掩码可以使用 <a href="https://www.v2ex.com/tools/ipv4">V2EX 提供的 IPv4 子网查询工具</a> 查询对应的子网。</li>
<li>网关根据创建网卡时选择的子网而定。</li>
</ul>
<p>新建 <code>ifcfg-eth1</code> 文件，将下方内容修改后填入</p>
<pre><code class="highlight ini"><span class="attr">DEVICE</span>=<span class="string">&quot;eth1&quot;</span>             <span class="comment"># 需配置的弹性网卡名称（此处是新添加的网卡名称）</span>
<span class="attr">NM_CONTROLLED</span>=<span class="string">&quot;yes&quot;</span>       <span class="comment"># 是否由 Network Manager 控制该网络接口</span>
<span class="attr">ONBOOT</span>=<span class="string">&quot;yes&quot;</span>              <span class="comment"># 系统启动时是否激活</span>
<span class="attr">IPADDR</span>=<span class="string">&quot;172.21.0.12&quot;</span>      <span class="comment"># 弹性网卡上的 IP 地址</span>
<span class="attr">NETMASK</span>=<span class="string">&quot;255.255.240.0&quot;</span>   <span class="comment"># 子网掩码</span>
<span class="comment"># GATEWAY=&quot;172.21.0.1&quot;    # 网关（若与eth0的网关不同，需要删除注释并修改为正确的网关）</span></code></pre>
<ul>
<li>其中 <code>IPADDR</code> 填写新添加网卡的<strong>内网IP</strong>。</li>
<li>子网掩码可以 <a href="https://www.v2ex.com/tools/ipv4">V2EX 提供的 IPv4 子网查询工具</a> 查询对应的子网。</li>
<li>网关根据创建网卡时选择的子网而定。</li>
</ul>
<p>保存后重启网络服务。</p>
<pre><code class="highlight bash">service network restart</code></pre>
<p><img src="https://vip1.loli.io/2020/11/26/ReBSM4C9oF2HbVi.png" alt="" loading="lazy" data-action="zoom"></p>
<h2 id="配置路由（可选）">配置路由（可选）</h2>
<blockquote>
<p>按照上述步骤配置好后，Linux 还是默认都从主网卡发包。
您可通过策略路由让报文从哪个网卡进，并从该网卡返回。</p>
</blockquote>
<h3 id="创建路由表">创建路由表</h3>
<pre><code class="highlight bash"><span class="built_in">echo</span> <span class="string">&quot;10 t1&quot;</span> &gt;&gt; /etc/iproute2/rt_tables
<span class="built_in">echo</span> <span class="string">&quot;20 t2&quot;</span> &gt;&gt; /etc/iproute2/rt_tables</code></pre>
<h3 id="添加默认路由">添加默认路由</h3>
<pre><code class="highlight bash">ip route add default dev eth0 via 172.21.0.1 table 10
ip route add default dev eth1 via 172.21.0.1 table 20</code></pre>
<blockquote>
<p>上述两个命令中，172.21.0.1要分别替换成主网卡所属子网的网关，以及辅助网卡所属子网的网关。</p>
</blockquote>
<h3 id="配置策略路由">配置策略路由</h3>
<pre><code class="highlight bash">ip rule add from 172.21.0.10 table 10
ip rule add from 172.21.0.12 table 20</code></pre> ]]></content>
        <summary><![CDATA[ 前言
良心云果然是良心云，增加了一个IP四舍五入居然不要钱，不过还是要登进系统配置一下双IP的。 ]]></summary>
        <category term="网络" />
        <category term="Linux" />
        <updated>2020-08-20T05:22:47.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/</id>
        <title>配置 nginx 只允许 CloudFlare 的 IP 回源</title>
        <link rel="alternate" href="https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/"/>
        <content type="html"><![CDATA[ <p>配置好 CloudFlare 后，建议禁止非 CloudFlare IP 访问源站来防止一些不好的事情发生。</p>
<a id="more"></a>
<h2 id="配置">配置</h2>
<p>在站点配置文件中增加以下内容<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> :</p>
<pre><code class="highlight nginx"><span class="comment"># CloudFlare (IPv4 - https://www.cloudflare.com/ips-v4)</span>
<span class="attribute">allow</span> <span class="number">173.245.48.0</span>/<span class="number">20</span>;
<span class="attribute">allow</span> <span class="number">103.21.244.0</span>/<span class="number">22</span>;
<span class="attribute">allow</span> <span class="number">103.22.200.0</span>/<span class="number">22</span>;
<span class="attribute">allow</span> <span class="number">103.31.4.0</span>/<span class="number">22</span>;
<span class="attribute">allow</span> <span class="number">141.101.64.0</span>/<span class="number">18</span>;
<span class="attribute">allow</span> <span class="number">108.162.192.0</span>/<span class="number">18</span>;
<span class="attribute">allow</span> <span class="number">190.93.240.0</span>/<span class="number">20</span>;
<span class="attribute">allow</span> <span class="number">188.114.96.0</span>/<span class="number">20</span>;
<span class="attribute">allow</span> <span class="number">197.234.240.0</span>/<span class="number">22</span>;
<span class="attribute">allow</span> <span class="number">198.41.128.0</span>/<span class="number">17</span>;
<span class="attribute">allow</span> <span class="number">162.158.0.0</span>/<span class="number">15</span>;
<span class="attribute">allow</span> <span class="number">104.16.0.0</span>/<span class="number">12</span>;
<span class="attribute">allow</span> <span class="number">172.64.0.0</span>/<span class="number">13</span>;
<span class="attribute">allow</span> <span class="number">131.0.72.0</span>/<span class="number">22</span>;
<span class="attribute">allow</span> <span class="number">36.27.212.0</span>/<span class="number">24</span>;
<span class="attribute">allow</span> <span class="number">123.129.232.0</span>/<span class="number">24</span>;

<span class="comment"># CloudFlare (IPv6 - https://www.cloudflare.com/ips-v6)</span>
<span class="attribute">allow</span> <span class="number">2400</span>:cb00::/<span class="number">32</span>;
<span class="attribute">allow</span> <span class="number">2405</span>:<span class="number">8100</span>::/<span class="number">32</span>;
<span class="attribute">allow</span> <span class="number">2405</span>:b500::/<span class="number">32</span>;
<span class="attribute">allow</span> <span class="number">2606</span>:<span class="number">4700</span>::/<span class="number">32</span>;
<span class="attribute">allow</span> <span class="number">2803</span>:f800::/<span class="number">32</span>;
<span class="attribute">allow</span> 2c0f:f248::/<span class="number">32</span>;
<span class="attribute">allow</span> 2a06:98c0::/<span class="number">29</span>;

<span class="comment"># Others</span>
<span class="attribute">deny</span> all;</code></pre>
<h2 id="后记">后记</h2>
<p>这个配置文件可以自己生成。</p>
<h2 id="参考资料">参考资料</h2>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a href="https://www.cloudflare.com/ips/">CloudFlare IP Ranges (Last updated: February 21, 2019)</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
 ]]></content>
        <summary><![CDATA[ 配置好 CloudFlare 后，建议禁止非 CloudFlare IP 访问源站来防止一些不好的事情发生。 ]]></summary>
        <category term="网络" />
        <updated>2020-08-18T05:32:04.000Z</updated>
    </entry>
</feed>