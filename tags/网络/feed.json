{
    "version": "https://jsonfeed.org/version/1",
    "title": "宝硕博客 • All posts by \"网络\" tag",
    "description": "宝硕博客 —— Baoshuo (@renbaoshuo) 随便写东西的地方，以技术向博文为主，生活向博文为辅。",
    "home_page_url": "https://blog.baoshuo.ren",
    "items": [
        {
            "id": "https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/",
            "url": "https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/",
            "title": "给腾讯云服务器免费增加第二个 IP",
            "date_published": "2020-08-20T05:22:47.000Z",
            "content_html": "<h2 id=\"前言\"><a class=\"anchor\" href=\"#前言\"></a>前言</h2>\n<p>良心云果然是良心云，增加了一个IP四舍五入居然不要钱，不过还是要登进系统配置一下双IP的。</p>\n<span id=\"more\"></span>\n<p><img src=\"https://vip2.loli.io/2020/11/26/rAyvBmDw2bdMP6t.jpg\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>和客服的对话</p>\n<h2 id=\"增加网卡-公网ip\"><a class=\"anchor\" href=\"#增加网卡-公网ip\"></a>增加网卡&amp;公网IP</h2>\n<p><img src=\"https://vip2.loli.io/2020/11/26/SWwlbLRaHACnuBz.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>点击按钮新建一个弹性网卡并绑定</p>\n<p><img src=\"https://vip1.loli.io/2020/11/26/sJqBfdbv4eRzZFm.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>绑定完以后可以在服务器的弹性网卡管理页面看到详情</p>\n<p><img src=\"https://vip1.loli.io/2020/11/26/ivPFgfH69XTCo8Z.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>点击新建的弹性网卡，进入管理页面，并记录下这张网卡的<strong>内网IP</strong>，稍后会用到</p>\n<p><img src=\"https://vip1.loli.io/2020/11/26/FAy8U5lpzNtuMTi.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>点击绑定按钮，并申请一个弹性公网IP</p>\n<p><img src=\"https://vip2.loli.io/2020/11/26/AbZ4vTwr1UCdz2n.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\">\n<img src=\"https://vip2.loli.io/2020/11/26/2G5jsdTSZrocqwh.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>此时弹性公网IP已经绑定成功，并且可以看到已经变为不收取IP资源费的状态了</p>\n<p><img src=\"https://vip1.loli.io/2020/11/26/x8q7I5E2dMSDt4B.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>查看主网卡的<strong>内网IP</strong>，并记录下这个IP，稍后会用到</p>\n<h2 id=\"配置服务器的网络设置\"><a class=\"anchor\" href=\"#配置服务器的网络设置\"></a>配置服务器的网络设置</h2>\n<p>使用 <code>ip addr</code> 查看网卡名称，并记录下来</p>\n<p><img src=\"https://vip2.loli.io/2020/11/26/Ofh8CzvnYKPGsH7.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<p>切换到网卡配置文件目录</p>\n<pre><code class=\"highlight bash\"><span class=\"built_in\">cd</span> /etc/sysconfig/network-scripts/</code></pre>\n<p>编辑 <code>ifcfg-eth0</code> 文件，将下方内容修改后填入</p>\n<pre><code class=\"highlight ini\"><span class=\"attr\">DEVICE</span>=<span class=\"string\">&quot;eth0&quot;</span>             <span class=\"comment\"># 弹性网卡名称</span>\n<span class=\"attr\">NM_CONTROLLED</span>=<span class=\"string\">&quot;yes&quot;</span>       <span class=\"comment\"># 是否由 Network Manager 控制该网络接口</span>\n<span class=\"attr\">ONBOOT</span>=<span class=\"string\">&quot;yes&quot;</span>              <span class=\"comment\"># 系统启动时是否激活</span>\n<span class=\"attr\">IPADDR</span>=<span class=\"string\">&quot;172.21.0.10&quot;</span>      <span class=\"comment\"># 弹性网卡上的 IP 地址</span>\n<span class=\"attr\">NETMASK</span>=<span class=\"string\">&quot;255.255.240.0&quot;</span>   <span class=\"comment\"># 子网掩码</span>\n<span class=\"attr\">GATEWAY</span>=<span class=\"string\">&quot;172.21.0.1&quot;</span>      <span class=\"comment\"># 网关</span></code></pre>\n<ul>\n<li>其中 <code>IPADDR</code> 填写主网卡的<strong>内网IP</strong>。</li>\n<li>子网掩码可以使用 <a href=\"https://www.v2ex.com/tools/ipv4\">V2EX 提供的 IPv4 子网查询工具</a> 查询对应的子网。</li>\n<li>网关根据创建网卡时选择的子网而定。</li>\n</ul>\n<p>新建 <code>ifcfg-eth1</code> 文件，将下方内容修改后填入</p>\n<pre><code class=\"highlight ini\"><span class=\"attr\">DEVICE</span>=<span class=\"string\">&quot;eth1&quot;</span>             <span class=\"comment\"># 需配置的弹性网卡名称（此处是新添加的网卡名称）</span>\n<span class=\"attr\">NM_CONTROLLED</span>=<span class=\"string\">&quot;yes&quot;</span>       <span class=\"comment\"># 是否由 Network Manager 控制该网络接口</span>\n<span class=\"attr\">ONBOOT</span>=<span class=\"string\">&quot;yes&quot;</span>              <span class=\"comment\"># 系统启动时是否激活</span>\n<span class=\"attr\">IPADDR</span>=<span class=\"string\">&quot;172.21.0.12&quot;</span>      <span class=\"comment\"># 弹性网卡上的 IP 地址</span>\n<span class=\"attr\">NETMASK</span>=<span class=\"string\">&quot;255.255.240.0&quot;</span>   <span class=\"comment\"># 子网掩码</span>\n<span class=\"comment\"># GATEWAY=&quot;172.21.0.1&quot;    # 网关（若与eth0的网关不同，需要删除注释并修改为正确的网关）</span></code></pre>\n<ul>\n<li>其中 <code>IPADDR</code> 填写新添加网卡的<strong>内网IP</strong>。</li>\n<li>子网掩码可以 <a href=\"https://www.v2ex.com/tools/ipv4\">V2EX 提供的 IPv4 子网查询工具</a> 查询对应的子网。</li>\n<li>网关根据创建网卡时选择的子网而定。</li>\n</ul>\n<p>保存后重启网络服务。</p>\n<pre><code class=\"highlight bash\">service network restart</code></pre>\n<p><img src=\"https://vip1.loli.io/2020/11/26/ReBSM4C9oF2HbVi.png\" alt=\"\" loading=\"lazy\" data-action=\"zoom\"></p>\n<h2 id=\"配置路由（可选）\"><a class=\"anchor\" href=\"#配置路由（可选）\"></a>配置路由（可选）</h2>\n<blockquote>\n<p>按照上述步骤配置好后，Linux 还是默认都从主网卡发包。\n您可通过策略路由让报文从哪个网卡进，并从该网卡返回。</p>\n</blockquote>\n<h3 id=\"创建路由表\"><a class=\"anchor\" href=\"#创建路由表\"></a>创建路由表</h3>\n<pre><code class=\"highlight bash\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;10 t1&quot;</span> &gt;&gt; /etc/iproute2/rt_tables\n<span class=\"built_in\">echo</span> <span class=\"string\">&quot;20 t2&quot;</span> &gt;&gt; /etc/iproute2/rt_tables</code></pre>\n<h3 id=\"添加默认路由\"><a class=\"anchor\" href=\"#添加默认路由\"></a>添加默认路由</h3>\n<pre><code class=\"highlight bash\">ip route add default dev eth0 via 172.21.0.1 table 10\nip route add default dev eth1 via 172.21.0.1 table 20</code></pre>\n<blockquote>\n<p>上述两个命令中，172.21.0.1要分别替换成主网卡所属子网的网关，以及辅助网卡所属子网的网关。</p>\n</blockquote>\n<h3 id=\"配置策略路由\"><a class=\"anchor\" href=\"#配置策略路由\"></a>配置策略路由</h3>\n<pre><code class=\"highlight bash\">ip rule add from 172.21.0.10 table 10\nip rule add from 172.21.0.12 table 20</code></pre>\n",
            "tags": [
                "网络",
                "Linux"
            ]
        },
        {
            "id": "https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/",
            "url": "https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/",
            "title": "配置 nginx 只允许 Cloudflare 的 IP 回源",
            "date_published": "2020-08-18T05:32:04.000Z",
            "content_html": "<p>配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。</p>\n<span id=\"more\"></span>\n<h2 id=\"配置\"><a class=\"anchor\" href=\"#配置\"></a>配置</h2>\n<p>在站点配置文件中增加以下内容<sup class=\"footnote-ref\"><a href=\"#fn1\" id=\"fnref1\">[1]</a></sup> :</p>\n<pre><code class=\"highlight nginx\"><span class=\"comment\"># Cloudflare (IPv4 - https://www.cloudflare.com/ips-v4)</span>\n<span class=\"attribute\">allow</span> <span class=\"number\">173.245.48.0</span>/<span class=\"number\">20</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">103.21.244.0</span>/<span class=\"number\">22</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">103.22.200.0</span>/<span class=\"number\">22</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">103.31.4.0</span>/<span class=\"number\">22</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">141.101.64.0</span>/<span class=\"number\">18</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">108.162.192.0</span>/<span class=\"number\">18</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">190.93.240.0</span>/<span class=\"number\">20</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">188.114.96.0</span>/<span class=\"number\">20</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">197.234.240.0</span>/<span class=\"number\">22</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">198.41.128.0</span>/<span class=\"number\">17</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">162.158.0.0</span>/<span class=\"number\">15</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">104.16.0.0</span>/<span class=\"number\">12</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">172.64.0.0</span>/<span class=\"number\">13</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">131.0.72.0</span>/<span class=\"number\">22</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">36.27.212.0</span>/<span class=\"number\">24</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">123.129.232.0</span>/<span class=\"number\">24</span>;\n\n<span class=\"comment\"># Cloudflare (IPv6 - https://www.cloudflare.com/ips-v6)</span>\n<span class=\"attribute\">allow</span> <span class=\"number\">2400</span>:cb00::/<span class=\"number\">32</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">2405</span>:<span class=\"number\">8100</span>::/<span class=\"number\">32</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">2405</span>:b500::/<span class=\"number\">32</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">2606</span>:<span class=\"number\">4700</span>::/<span class=\"number\">32</span>;\n<span class=\"attribute\">allow</span> <span class=\"number\">2803</span>:f800::/<span class=\"number\">32</span>;\n<span class=\"attribute\">allow</span> 2c0f:f248::/<span class=\"number\">32</span>;\n<span class=\"attribute\">allow</span> 2a06:98c0::/<span class=\"number\">29</span>;\n\n<span class=\"comment\"># Others</span>\n<span class=\"attribute\">deny</span> all;</code></pre>\n<h2 id=\"后记\"><a class=\"anchor\" href=\"#后记\"></a>后记</h2>\n<p>这个配置文件可以自己生成。</p>\n<h2 id=\"参考资料\"><a class=\"anchor\" href=\"#参考资料\"></a>参考资料</h2>\n<hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p><a href=\"https://www.cloudflare.com/ips/\">Cloudflare IP Ranges (Last updated: February 21, 2019)</a> <a href=\"#fnref1\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n</ol>\n</section>\n",
            "tags": [
                "网络"
            ]
        }
    ]
}