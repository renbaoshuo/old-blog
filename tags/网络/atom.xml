<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.baoshuo.ren</id>
    <title>宝硕博客 • Posts by &#34;网络&#34; tag</title>
    <link href="https://blog.baoshuo.ren" />
    <updated>2020-08-20T05:22:47.000Z</updated>
    <category term="BIRD" />
    <category term="BGP" />
    <category term="算法" />
    <category term="图论" />
    <category term="笔记" />
    <category term="Web" />
    <category term="DN42" />
    <category term="Git" />
    <category term="CTF" />
    <category term="折腾" />
    <category term="Linux" />
    <category term="网络" />
    <category term="题解" />
    <category term="洛谷" />
    <category term="游记" />
    <category term="牛客网" />
    <category term="S2OJ" />
    <category term="macOS" />
    <category term="Cloudflare" />
    <category term="前端" />
    <category term="比赛" />
    <entry>
        <id>https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/</id>
        <title>给腾讯云服务器免费增加第二个 IP</title>
        <link rel="alternate" href="https://blog.baoshuo.ren/post/tencent-cloud-cvm-dual-ip/"/>
        <content type="html">&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;良心云果然是良心云，增加了一个IP四舍五入居然不要钱，不过还是要登进系统配置一下双IP的。&lt;/p&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;p&gt;&lt;img src=&#34;https://vip2.loli.io/2020/11/26/rAyvBmDw2bdMP6t.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;和客服的对话&lt;/p&gt;
&lt;h2 id=&#34;增加网卡-公网IP&#34;&gt;增加网卡&amp;amp;公网IP&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://vip2.loli.io/2020/11/26/SWwlbLRaHACnuBz.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;点击按钮新建一个弹性网卡并绑定&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://vip1.loli.io/2020/11/26/sJqBfdbv4eRzZFm.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;绑定完以后可以在服务器的弹性网卡管理页面看到详情&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://vip1.loli.io/2020/11/26/ivPFgfH69XTCo8Z.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;点击新建的弹性网卡，进入管理页面，并记录下这张网卡的&lt;strong&gt;内网IP&lt;/strong&gt;，稍后会用到&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://vip1.loli.io/2020/11/26/FAy8U5lpzNtuMTi.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;点击绑定按钮，并申请一个弹性公网IP&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://vip2.loli.io/2020/11/26/AbZ4vTwr1UCdz2n.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;
&lt;img src=&#34;https://vip2.loli.io/2020/11/26/2G5jsdTSZrocqwh.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;此时弹性公网IP已经绑定成功，并且可以看到已经变为不收取IP资源费的状态了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://vip1.loli.io/2020/11/26/x8q7I5E2dMSDt4B.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;查看主网卡的&lt;strong&gt;内网IP&lt;/strong&gt;，并记录下这个IP，稍后会用到&lt;/p&gt;
&lt;h2 id=&#34;配置服务器的网络设置&#34;&gt;配置服务器的网络设置&lt;/h2&gt;
&lt;p&gt;使用 &lt;code&gt;ip addr&lt;/code&gt; 查看网卡名称，并记录下来&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://vip2.loli.io/2020/11/26/Ofh8CzvnYKPGsH7.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;p&gt;切换到网卡配置文件目录&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; /etc/sysconfig/network-scripts/&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;编辑 &lt;code&gt;ifcfg-eth0&lt;/code&gt; 文件，将下方内容修改后填入&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight ini&#34;&gt;&lt;span class=&#34;attr&#34;&gt;DEVICE&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;eth0&amp;quot;&lt;/span&gt;             &lt;span class=&#34;comment&#34;&gt;# 弹性网卡名称&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;NM_CONTROLLED&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;       &lt;span class=&#34;comment&#34;&gt;# 是否由 Network Manager 控制该网络接口&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;ONBOOT&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;              &lt;span class=&#34;comment&#34;&gt;# 系统启动时是否激活&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;IPADDR&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;172.21.0.10&amp;quot;&lt;/span&gt;      &lt;span class=&#34;comment&#34;&gt;# 弹性网卡上的 IP 地址&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;NETMASK&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;255.255.240.0&amp;quot;&lt;/span&gt;   &lt;span class=&#34;comment&#34;&gt;# 子网掩码&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;GATEWAY&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;172.21.0.1&amp;quot;&lt;/span&gt;      &lt;span class=&#34;comment&#34;&gt;# 网关&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;其中 &lt;code&gt;IPADDR&lt;/code&gt; 填写主网卡的&lt;strong&gt;内网IP&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;子网掩码可以使用 &lt;a href=&#34;https://www.v2ex.com/tools/ipv4&#34;&gt;V2EX 提供的 IPv4 子网查询工具&lt;/a&gt; 查询对应的子网。&lt;/li&gt;
&lt;li&gt;网关根据创建网卡时选择的子网而定。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;新建 &lt;code&gt;ifcfg-eth1&lt;/code&gt; 文件，将下方内容修改后填入&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight ini&#34;&gt;&lt;span class=&#34;attr&#34;&gt;DEVICE&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;eth1&amp;quot;&lt;/span&gt;             &lt;span class=&#34;comment&#34;&gt;# 需配置的弹性网卡名称（此处是新添加的网卡名称）&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;NM_CONTROLLED&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;       &lt;span class=&#34;comment&#34;&gt;# 是否由 Network Manager 控制该网络接口&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;ONBOOT&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;              &lt;span class=&#34;comment&#34;&gt;# 系统启动时是否激活&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;IPADDR&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;172.21.0.12&amp;quot;&lt;/span&gt;      &lt;span class=&#34;comment&#34;&gt;# 弹性网卡上的 IP 地址&lt;/span&gt;
&lt;span class=&#34;attr&#34;&gt;NETMASK&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;255.255.240.0&amp;quot;&lt;/span&gt;   &lt;span class=&#34;comment&#34;&gt;# 子网掩码&lt;/span&gt;
&lt;span class=&#34;comment&#34;&gt;# GATEWAY=&amp;quot;172.21.0.1&amp;quot;    # 网关（若与eth0的网关不同，需要删除注释并修改为正确的网关）&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;其中 &lt;code&gt;IPADDR&lt;/code&gt; 填写新添加网卡的&lt;strong&gt;内网IP&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;子网掩码可以 &lt;a href=&#34;https://www.v2ex.com/tools/ipv4&#34;&gt;V2EX 提供的 IPv4 子网查询工具&lt;/a&gt; 查询对应的子网。&lt;/li&gt;
&lt;li&gt;网关根据创建网卡时选择的子网而定。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;保存后重启网络服务。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;service network restart&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://vip1.loli.io/2020/11/26/ReBSM4C9oF2HbVi.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;配置路由（可选）&#34;&gt;配置路由（可选）&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;按照上述步骤配置好后，Linux 还是默认都从主网卡发包。
您可通过策略路由让报文从哪个网卡进，并从该网卡返回。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;创建路由表&#34;&gt;创建路由表&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;10 t1&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/iproute2/rt_tables
&lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;20 t2&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/iproute2/rt_tables&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;添加默认路由&#34;&gt;添加默认路由&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;ip route add default dev eth0 via 172.21.0.1 table 10
ip route add default dev eth1 via 172.21.0.1 table 20&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;上述两个命令中，172.21.0.1要分别替换成主网卡所属子网的网关，以及辅助网卡所属子网的网关。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;配置策略路由&#34;&gt;配置策略路由&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;ip rule add from 172.21.0.10 table 10
ip rule add from 172.21.0.12 table 20&lt;/code&gt;&lt;/pre&gt;</content>
        <category term="Linux" />
        <category term="网络" />
        <updated>2020-08-20T05:22:47.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/</id>
        <title>配置 nginx 只允许 Cloudflare 的 IP 回源</title>
        <link rel="alternate" href="https://blog.baoshuo.ren/post/nginx-cloudflare-ip-only/"/>
        <content type="html">&lt;p&gt;配置好 Cloudflare 后，建议禁止非 Cloudflare IP 访问源站来防止一些不好的事情发生。&lt;/p&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;h2 id=&#34;配置&#34;&gt;配置&lt;/h2&gt;
&lt;p&gt;在站点配置文件中增加以下内容&lt;sup class=&#34;footnote-ref&#34;&gt;&lt;a href=&#34;#fn1&#34; id=&#34;fnref1&#34;&gt;[1]&lt;/a&gt;&lt;/sup&gt; :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight nginx&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# Cloudflare (IPv4 - https://www.cloudflare.com/ips-v4)&lt;/span&gt;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;173.245.48.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;103.21.244.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;22&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;103.22.200.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;22&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;103.31.4.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;22&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;141.101.64.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;108.162.192.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;18&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;190.93.240.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;188.114.96.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;197.234.240.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;22&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;198.41.128.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;17&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;162.158.0.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;15&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;104.16.0.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;12&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;172.64.0.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;13&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;131.0.72.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;22&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;36.27.212.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;24&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;123.129.232.0&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;24&lt;/span&gt;;

&lt;span class=&#34;comment&#34;&gt;# Cloudflare (IPv6 - https://www.cloudflare.com/ips-v6)&lt;/span&gt;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2400&lt;/span&gt;:cb00::/&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2405&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;8100&lt;/span&gt;::/&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2405&lt;/span&gt;:b500::/&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2606&lt;/span&gt;:&lt;span class=&#34;number&#34;&gt;4700&lt;/span&gt;::/&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2803&lt;/span&gt;:f800::/&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; 2c0f:f248::/&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;;
&lt;span class=&#34;attribute&#34;&gt;allow&lt;/span&gt; 2a06:98c0::/&lt;span class=&#34;number&#34;&gt;29&lt;/span&gt;;

&lt;span class=&#34;comment&#34;&gt;# Others&lt;/span&gt;
&lt;span class=&#34;attribute&#34;&gt;deny&lt;/span&gt; all;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;后记&#34;&gt;后记&lt;/h2&gt;
&lt;p&gt;这个配置文件可以自己生成。&lt;/p&gt;
&lt;h2 id=&#34;参考资料&#34;&gt;参考资料&lt;/h2&gt;
&lt;hr class=&#34;footnotes-sep&#34;&gt;
&lt;section class=&#34;footnotes&#34;&gt;
&lt;ol class=&#34;footnotes-list&#34;&gt;
&lt;li id=&#34;fn1&#34; class=&#34;footnote-item&#34;&gt;&lt;p&gt;&lt;a href=&#34;https://www.cloudflare.com/ips/&#34;&gt;Cloudflare IP Ranges (Last updated: February 21, 2019)&lt;/a&gt; &lt;a href=&#34;#fnref1&#34; class=&#34;footnote-backref&#34;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
        <category term="网络" />
        <updated>2020-08-18T05:32:04.000Z</updated>
    </entry>
</feed>