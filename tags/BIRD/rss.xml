  
<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>宝硕博客 • Posts by &#34;bird&#34; tag</title>
        <link>https://blog.baoshuo.ren</link>
        <description>宝硕博客 —— Baoshuo (@renbaoshuo) 随便写东西的地方，以技术向博文为主，生活向博文为辅。</description>
        <language>cn</language>
        <pubDate>Mon, 03 May 2021 12:23:00 +0800</pubDate>
        <lastBuildDate>Mon, 03 May 2021 12:23:00 +0800</lastBuildDate>
        <category>算法</category>
        <category>图论</category>
        <category>笔记</category>
        <category>BIRD</category>
        <category>BGP</category>
        <category>CTF</category>
        <category>Git</category>
        <category>DN42</category>
        <category>Web</category>
        <category>折腾</category>
        <category>Linux</category>
        <category>网络</category>
        <category>VMware</category>
        <category>OI</category>
        <category>题解</category>
        <category>洛谷</category>
        <category>游记</category>
        <category>牛客网</category>
        <category>S2OJ</category>
        <category>Cloudflare</category>
        <category>macOS</category>
        <category>ServiceWorker</category>
        <category>JavaScript</category>
        <category>前端</category>
        <category>比赛</category>
        <item>
            <guid isPermalink="true">https://blog.baoshuo.ren/post/bird-looking-glass/</guid>
            <title>搭建 BIRD Looking Glass 速成指北</title>
            <link>https://blog.baoshuo.ren/post/bird-looking-glass/</link>
            <category>BIRD</category>
            <category>BGP</category>
            <category>DN42</category>
            <pubDate>Mon, 03 May 2021 12:23:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;BIRD 是 Linux 上常用的一款 BGP 路由软件。bird-lg-go 是 &lt;a href=&#34;https://lantian.pub&#34;&gt;蓝天&lt;/a&gt; 使用 Go 语言编写的 Looking Glass 程序，内存占用比原版 bird-lg 更低。它提供了一个网页面板，可以显示各个服务器上的 BIRD 路由软件的状态，以及查询到指定 IP 的路由。&lt;/p&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;项目地址：&lt;a href=&#34;https://github.com/xddxdd/bird-lg-go&#34;&gt;https://github.com/xddxdd/bird-lg-go&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;成品： &lt;a href=&#34;https://lg.dn42.as141776.net&#34;&gt;https://lg.dn42.as141776.net&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;安装-Docker-和-Docker-Compose&#34;&gt;安装 Docker 和 Docker Compose&lt;/h2&gt;
&lt;p&gt;虽然这个程序可以直接运行，但我还是比较喜欢套个 Docker 防止污染环境。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;curl -sSL https://get.docker.com | sh
pip install docker-compose&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;编排-Docker-Compose-服务&#34;&gt;编排 Docker Compose 服务&lt;/h2&gt;
&lt;p&gt;在运行 web 的服务器上找个地方（如 &lt;code&gt;/var/bird-lg/&lt;/code&gt;），将下面的内容修改后写入 &lt;code&gt;docker-compose.yml&lt;/code&gt; 中：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight yml&#34;&gt;&lt;span class=&#34;attr&#34;&gt;version:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;3&amp;#x27;&lt;/span&gt;

&lt;span class=&#34;attr&#34;&gt;services:&lt;/span&gt;
  &lt;span class=&#34;attr&#34;&gt;bird-lg:&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;xddxdd/bird-lg-go&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;bird-lg&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;always&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;environment:&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;BIRDLG_SERVERS=cn1,eu1&lt;/span&gt;              &lt;span class=&#34;comment&#34;&gt;# 节点列表，以逗号分隔&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;BIRDLG_DOMAIN=dn42.as141776.net&lt;/span&gt;     &lt;span class=&#34;comment&#34;&gt;# 节点 endpiont 后缀&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;BIRDLG_TITLE_BRAND=Looking&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Glass&lt;/span&gt;    &lt;span class=&#34;comment&#34;&gt;# 标签栏上显示的名称&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;BIRDLG_NAVBAR_BRAND=Looking&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Glass&lt;/span&gt;   &lt;span class=&#34;comment&#34;&gt;# 页面上显示的名称&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;BIRDLG_WHOIS=whois.lantian.dn42&lt;/span&gt;     &lt;span class=&#34;comment&#34;&gt;# Whois 服务器地址&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;BIRDLG_DNS_INTERFACE=asn.dn42&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;5000:5000&amp;quot;&lt;/span&gt;
  &lt;span class=&#34;attr&#34;&gt;bird-lgproxy:&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;xddxdd/bird-lgproxy-go&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;bird-lgproxy&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;always&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;/var/run/bird/bird.ctl:/var/run/bird/bird.ctl&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;8000:8000&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在各个节点上只需要写入下面内容即可：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight yml&#34;&gt;&lt;span class=&#34;attr&#34;&gt;version:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;3&amp;#x27;&lt;/span&gt;

&lt;span class=&#34;attr&#34;&gt;services:&lt;/span&gt;
  &lt;span class=&#34;attr&#34;&gt;bird-lgproxy:&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;xddxdd/bird-lgproxy-go&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;container_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;bird-lgproxy&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;restart:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;always&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;/var/run/bird/bird.ctl:/var/run/bird/bird.ctl&amp;quot;&lt;/span&gt;
    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;
      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;8000:8000&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;之后启动 Docker 容器：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight bash&#34;&gt;docker-compose up -d&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;使用-nginx-反代页面&#34;&gt;使用 nginx 反代页面&lt;/h2&gt;
&lt;p&gt;使用下方的配置启动反向代理即可。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight nginx&#34;&gt;&lt;span class=&#34;section&#34;&gt;server&lt;/span&gt; &amp;#123;
    &lt;span class=&#34;attribute&#34;&gt;listen&lt;/span&gt;      *:&lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;;
    &lt;span class=&#34;attribute&#34;&gt;listen&lt;/span&gt;      [::]:&lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;;
    &lt;span class=&#34;attribute&#34;&gt;server_name&lt;/span&gt; lg.dn42.as141776.net;

    &lt;span class=&#34;comment&#34;&gt;# reverse proxy&lt;/span&gt;
    &lt;span class=&#34;attribute&#34;&gt;location&lt;/span&gt; / &amp;#123;
        &lt;span class=&#34;attribute&#34;&gt;proxy_pass&lt;/span&gt;                         http://127.0.0.1:5000;
        &lt;span class=&#34;attribute&#34;&gt;proxy_http_version&lt;/span&gt;                 &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;.&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;
        &lt;span class=&#34;attribute&#34;&gt;proxy_cache_bypass&lt;/span&gt;                 $http_upgrade;

        &lt;span class=&#34;comment&#34;&gt;# Proxy headers&lt;/span&gt;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; Upgrade           $http_upgrade;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; Host              $host;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; X-Real-IP         $remote_addr;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; X-Forwarded-For   $proxy_add_x_forwarded_for;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; X-Forwarded-Proto $scheme;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; X-Forwarded-Host  $host;
        &lt;span class=&#34;attribute&#34;&gt;proxy_set_header&lt;/span&gt; X-Forwarded-Port  $server_port;

        &lt;span class=&#34;comment&#34;&gt;# Proxy timeouts&lt;/span&gt;
        &lt;span class=&#34;attribute&#34;&gt;proxy_connect_timeout&lt;/span&gt;              &lt;span class=&#34;number&#34;&gt;60s&lt;/span&gt;;
        &lt;span class=&#34;attribute&#34;&gt;proxy_send_timeout&lt;/span&gt;                 &lt;span class=&#34;number&#34;&gt;60s&lt;/span&gt;;
        &lt;span class=&#34;attribute&#34;&gt;proxy_read_timeout&lt;/span&gt;                 &lt;span class=&#34;number&#34;&gt;60s&lt;/span&gt;;
    &amp;#125;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;配置-DNS-解析&#34;&gt;配置 DNS 解析&lt;/h2&gt;
&lt;p&gt;bird-lg-go 的节点 endpiont 生成逻辑是 &lt;code&gt;http://[节点].[endpoint后缀]:8000&lt;/code&gt; ，如 &lt;code&gt;http://eu1.dn42.as141776.net:8000&lt;/code&gt; ，所以只需要去配置对应的解析。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;警告&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;建议解析到节点的公网 IP 上，以免 DN42 炸掉时 Looking Glass 也一并炸掉。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;配置示例：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;highlight stylus&#34;&gt;eu1&lt;span class=&#34;selector-class&#34;&gt;.dn42&lt;/span&gt;&lt;span class=&#34;selector-class&#34;&gt;.as141776&lt;/span&gt;&lt;span class=&#34;selector-class&#34;&gt;.net&lt;/span&gt;.  &lt;span class=&#34;number&#34;&gt;3600&lt;/span&gt;    IN      A       &lt;span class=&#34;number&#34;&gt;136.243&lt;/span&gt;.&lt;span class=&#34;number&#34;&gt;221.96&lt;/span&gt;
cn1&lt;span class=&#34;selector-class&#34;&gt;.dn42&lt;/span&gt;&lt;span class=&#34;selector-class&#34;&gt;.as141776&lt;/span&gt;&lt;span class=&#34;selector-class&#34;&gt;.net&lt;/span&gt;.  &lt;span class=&#34;number&#34;&gt;3600&lt;/span&gt;    IN      CNAME   home&lt;span class=&#34;selector-class&#34;&gt;.baoshuo&lt;/span&gt;&lt;span class=&#34;selector-class&#34;&gt;.ren&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;成果&#34;&gt;成果&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://vip2.loli.io/2021/05/03/iaFfTWAhpdZGJ9t.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-action=&#34;zoom&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>